import{r as n,aY as Q,cH as U,aL as Z,j as t,B as d,eN as ee,T as w,N as te,m as ae,eO as re,I as ie,aK as c,n as oe,O as _,aQ as N,aO as se,aP as ne,aR as de,aS as le,W as ce,p as H,c as he,aN as pe}from"./index-e8afd095.js";import{C as fe}from"./custom-breadcrumbs-c41d8ef9.js";import{u as xe,c as ge,v as ue,h as be,l as me,r as ye,t as we,b as ke,a as Ce}from"./getTablesData-c52d360d.js";import"./axios_config-5528865c.js";const je=n.forwardRef((p,x)=>{const a=JSON.parse(localStorage.getItem("settings")),{data:o,isLoading:C,error:De}=xe(),T={width:(o==null?void 0:o.boardWidth)||1100,height:(o==null?void 0:o.boardHeight)||650},A=Q(),[g,L]=n.useState(!1),[j,X]=n.useState(!1),R=()=>{L(!g)},$=()=>{X(!j)},[k,ve]=n.useState([{name:"circle-table",content:"⭕",key:"Circle Table",img:ge},{name:"vertical-table",content:"◼️",key:"Vertical Table",img:ue},{name:"rec-table",content:"◼️",key:"Horizontal Table",img:be},{name:"left-chair",content:"🪑",key:"Left Chair",img:me},{name:"right-chair",content:"🪑",key:"Right Chair",img:ye},{name:"top-chair",content:"🪑",key:"Top Chair",img:we},{name:"bottom-chair",content:"🪑",key:"Bottom Chair",img:ke}]),[u,b]=n.useState((o==null?void 0:o.assets)||[]),[l,E]=n.useState(T),[z,Y]=n.useState([]),B=(e,i)=>{const r=e.clientX-e.target.getBoundingClientRect().left,s=e.clientY-e.target.getBoundingClientRect().top;e.dataTransfer.setData("text",i),e.dataTransfer.setData("offsetX",r),e.dataTransfer.setData("offsetY",s)},O=e=>{e.preventDefault();const i=e.dataTransfer.getData("text"),r=parseFloat(e.dataTransfer.getData("offsetX")),s=parseFloat(e.dataTransfer.getData("offsetY")),D=e.currentTarget.getBoundingClientRect();let f,m;N.language==="ar"?f=D.right-e.clientX-r+window.scrollX:f=e.clientX-D.left-r+window.scrollX,m=e.clientY-D.top-s+window.scrollY;const G=l.width-30,K=l.height-30;if(f=Math.min(Math.max(f,0),G),m=Math.min(Math.max(m,0),K),k.some(h=>h.name===i)){const h=k.find(v=>v.name===i),y=h.key.includes("Chair");b(v=>[...v,{name:`copy_${Math.random().toString(36).substring(2,9)}`,content:h.content,x:f,y:m,img:h.img,key:h.key,...y?{nfc_number:""}:{}}])}else b(h=>h.map(y=>y.name===i?{...y,x:f,y:m}:y))},F=(e,i)=>{b(r=>r.map(s=>s.name===e&&s.key.includes("Chair")?{...s,nfc_number:i||""}:s))},I=(e,i)=>{E({width:e,height:i})},P=e=>{b(i=>i.filter(r=>r.name!==e))};n.useEffect(()=>{b(o==null?void 0:o.assets),E(T)},[o]),n.useEffect(()=>{Y(u)},[u,l]);const W=window.localStorage.getItem("user_data"),S=U(W),q=()=>{for(const e of z)for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];if(!r||r==="")return R(),!1}return!0},{mutate:J,error:Te,isError:Re,isLoading:M}=Z({mutationFn:e=>se.post(`${ne}dashboard/restaurant/tables/create`,e,{headers:{"Content-Type":"multipart/form-data","Accept-Language":N.language,Authorization:`Bearer ${S==null?void 0:S.token}`}}),onSuccess:()=>{de(c("tables-seccess")),A("/dashboard/tables/list")},onError:()=>{le(c("error"))}}),V=()=>{const e=new FormData;if(z.forEach((i,r)=>{Object.keys(i).forEach(s=>{e.append(`assets[${r}][${s}]`,s==="nfc_number"?parseInt(i[s]):i[s])})}),e.append("boardWidth",l.width),e.append("boardHeight",l.height),q())J(e);else{alert(c("num-required"));return}};return n.useEffect(()=>{M?p.setLoading(!0):p.setLoading(!1)},[M]),n.useImperativeHandle(x,()=>({saveData:V})),t.jsxs(d,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsx(d,{sx:{position:"fixed",zIndex:"1102",top:0,left:0,width:"100%",height:"100%",background:"#00000078",visibility:C?"":"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx(ee,{})}),t.jsxs(d,{sx:{display:"flex",width:"100%"},children:[t.jsxs(d,{sx:{position:"sticky",top:"70px",left:"0",height:"max-content",margin:"0px 15px",width:"110px",border:"1px solid white",borderRadius:"10px",padding:"10px",borderColor:(a==null?void 0:a.themeMode)==="dark"?"#ffffff":"#161C24"},children:[k.map((e,i)=>t.jsxs(d,{draggable:!0,sx:{borderRadius:"5px",cursor:"grab",width:"90px",maxHeight:"auto",border:"1px solid white",borderColor:(a==null?void 0:a.themeMode)==="dark"?"#ffffff":"#161C24",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:"20px",textAlign:"center",padding:"3px"},onDragStart:r=>B(r,e.name),children:[t.jsx(w,{fontSize:"40px",children:e.content}),t.jsx(w,{fontSize:"12px",mt:-2,children:e.key})]},`element-${e.name}`)),t.jsxs(d,{sx:{position:"relative",padding:" 10px",border:"1px solid white",borderColor:(a==null?void 0:a.themeMode)==="dark"?"#ffffff":"#161C24",borderRadius:"5px",width:"100%",display:"flex",justifyContent:"center"},children:[t.jsx(te,{component:ae.button,whileTap:"tap",whileHover:"hover",variants:re(1.05),"aria-label":"settings",onClick:$,sx:{width:40,height:40},children:t.jsx(ie,{icon:"solar:settings-bold-duotone",width:24})}),t.jsxs(d,{sx:{position:"absolute",right:"-225px",bottom:"35px",zIndex:"100",width:"250px",background:(a==null?void 0:a.themeMode)==="dark"?"#181818":"#e0e0e0",padding:"10px",borderRadius:"10px",transition:"0.4s",visibility:j?"":"hidden",opacity:j?"1":"0"},children:[t.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid white",borderColor:(a==null?void 0:a.themeMode)==="dark"?"#ffffff":"#161C24",padding:"5px",borderRadius:"10px"},children:[t.jsx(w,{fontSize:"12px",children:c("add-chair-num")}),t.jsx(oe,{onChange:R,checked:g&&!0})]}),t.jsx(_,{sx:{my:"20px",width:"100%"},label:"Width",variant:"outlined",type:"number",value:l.width,onChange:e=>I(Number(e.target.value),l.height)}),t.jsx(_,{label:"Height",variant:"outlined",type:"number",sx:{width:"100%"},value:l.height,onChange:e=>I(l.width,Number(e.target.value))})]})]})]}),t.jsx(d,{sx:{overflow:"auto",border:"1px solid white",borderRadius:"5px",backgroundImage:`url(${Ce})`,backgroundSize:"cover",backgroundRepeat:"no-repeat",borderColor:(a==null?void 0:a.themeMode)==="dark"?"white":"#161C24",backgroundPosition:"center",height:"max-content","&::-webkit-scrollbar":{width:"6px",height:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"grey",borderRadius:"20px"},"&::-webkit-scrollbar-track":{backgroundColor:"#ffffff19"},mx:{xs:"20p !important",md:"10px",lg:"0px"}},onDragOver:e=>e.preventDefault(),onDrop:O,children:t.jsx(d,{sx:{width:l.width+"px",height:l.height+"px",position:"relative",borderRadius:"10px"},children:u==null?void 0:u.map((e,i)=>t.jsxs(d,{sx:{position:"absolute",top:e.y+"px",border:"1px solid white",borderRadius:"5px",borderColor:(a==null?void 0:a.themeMode)==="dark"?"#ffffff":"#161C24",textAlign:"center",padding:e.key==="Vertical Table"?"50px 3px":"3px",":hover":{cursor:"move"},left:e.x+"px"},draggable:"true",onDragStart:r=>B(r,e.name),onDoubleClick:()=>{!g&&P(e.name)},children:[k.map(r=>r.key===e.key&&t.jsx(w,{fontSize:"40px",sx:{width:r.key==="Horizontal Table"?"150px":""},children:r.content},`element-${e.name||i}`)),e.key.includes("Chair")&&t.jsx(d,{sx:{position:"absolute",top:0,right:"-105px",textAlign:"center",zIndex:100,transition:"0.4s",display:g?"":"none",opacity:g?"1":"0"},children:t.jsx("input",{size:"small",value:e.nfc_number||"",type:"number",id:"nfc_num",required:!0,style:{textAlign:"center",width:"100px",padding:"10px",border:"1px solid white",borderRadius:"5px",outline:"none",background:"white",color:"#161C24"},onChange:r=>F(e.name,r.target.value),placeholder:"Chair Number"})}),t.jsx(w,{fontSize:"10px",mt:-2,children:e.key})]},`element-${e.name}`))})})]})]})}),Se=je;function _e(){const p=n.useRef(),x=JSON.parse(localStorage.getItem("settings")),[a,o]=n.useState(!1),C=()=>{p.current&&p.current.saveData()};return t.jsxs(t.Fragment,{children:[t.jsx(ce,{children:t.jsx("title",{children:" Dashboard: Edit Tables"})}),t.jsx(fe,{heading:c("edit")+" "+c("tables"),links:[{name:c("dashboard"),href:H.dashboard.root},{name:c("tables"),href:H.dashboard.tables.list},{name:c("edit")}],action:t.jsx(he,{variant:"contained",onClick:C,children:a?t.jsx(pe,{color:(x==null?void 0:x.themeMode)==="dark"?"#161C24":"#ffffff",size:23}):c("save-changes")}),sx:{mb:{xs:3,md:5}}}),t.jsx(Se,{ref:p,setLoading:o})]})}export{_e as default};
