import{c6 as _,r as c,f5 as Ie,c7 as R,P as h,dp as M,u as q,aT as F,p as N,j as e,z as A,A as C,a6 as U,ad as z,S as x,T as k,B as I,c3 as Re,c4 as Oe,cn as Ae,N as y,I as u,D as Le,Q as W,ds as Ne,cy as $e,ct as se,cp as te,a as ne,O as oe,aK as Pe,$ as Ue,aw as H,a5 as re,d3 as Me,d8 as De,cO as Fe,f6 as ze,bW as Ge,aG as Ee,e as T,a2 as ae,bQ as ie,f7 as We,f8 as Ve,bG as Be,dA as _e,co as qe,x as He,cG as Ke,l as Qe,aU as Ye,C as Je,h as Xe,W as Ze}from"./index-df7ae4b9.js";import{k as es,f as le}from"./keyBy-b4dfe8e4.js";import{u as K,m as D}from"./index-416ff554.js";import{A as ce}from"./AvatarGroup-6908051e.js";import{S as V}from"./Skeleton-6a702a13.js";import{C as ss}from"./ClickAwayListener-c9fb8d08.js";import{D as ts}from"./DialogContent-3eedbbd7.js";import{u as ns,L as os}from"./lightbox-8435d36e.js";import{u as J}from"./uuidv4-bea31cbe.js";import{C as rs}from"./custom-breadcrumbs-83f12610.js";import"./_baseEach-f18d351b.js";import"./_baseIteratee-74d7a9b2.js";import"./_baseToString-67d9cb13.js";import"./dialogTitleClasses-4d60fd4f.js";const Q={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function as(){const t=[R.chat,{params:{endpoint:"contacts"}}],{data:o,isLoading:n,error:r,isValidating:a}=K(t,_,Q);return c.useMemo(()=>({contacts:(o==null?void 0:o.contacts)||[],contactsLoading:n,contactsError:r,contactsValidating:a,contactsEmpty:!n&&!(o!=null&&o.contacts.length)}),[o==null?void 0:o.contacts,r,n,a])}function is(){const t=[R.chat,{params:{endpoint:"conversations"}}],{data:o,isLoading:n,error:r,isValidating:a}=K(t,_,Q);return c.useMemo(()=>{const i=es(o==null?void 0:o.conversations,"id")||{},l=Object.keys(i)||[];return{conversations:{byId:i,allIds:l},conversationsLoading:n,conversationsError:r,conversationsValidating:a,conversationsEmpty:!n&&!l.length}},[o==null?void 0:o.conversations,r,n,a])}function ls(t){const o=t?[R.chat,{params:{conversationId:t,endpoint:"conversation"}}]:null,{data:n,isLoading:r,error:a,isValidating:s}=K(o,_,Q);return c.useMemo(()=>({conversation:n==null?void 0:n.conversation,conversationLoading:r,conversationError:a,conversationValidating:s}),[n==null?void 0:n.conversation,a,r,s])}async function cs(t,o){const n=[R.chat,{params:{endpoint:"conversations"}}],r=[R.chat,{params:{conversationId:t,endpoint:"conversation"}}];D(r,a=>{const{conversation:s}=a;return{conversation:{...s,messages:[...s.messages,o]}}},!1),D(n,a=>{const{conversations:s}=a;return{conversations:s.map(l=>l.id===t?{...l,messages:[...l.messages,o]}:l)}},!1)}async function ds(t){const o=[R.chat,{params:{endpoint:"conversations"}}],n={conversationData:t},r=await Ie.post(R.chat,n);return D(o,a=>{const s=[...a.conversations,t];return{...a,conversations:s}},!1),r.data}async function hs(t){const o=R.chat;D([o,{params:{endpoint:"conversations"}}],n=>{const r=n.conversations.map(a=>a.id===t?{...a,unreadCount:0}:a);return{...n,conversations:r}},!1)}function ps({message:t,participants:o,currentUserId:n}){const r=o.find(l=>l.id===t.senderId),a=t.senderId===n?{type:"me"}:{avatarUrl:r==null?void 0:r.avatarUrl,firstName:r==null?void 0:r.name.split(" ")[0]},s=a.type==="me";return{hasImage:t.contentType==="image",me:s,senderDetails:a}}function xs({currentUserId:t,conversation:o}){const{messages:n,participants:r}=o,a=r.filter(m=>m.id!==t),s=n[n.length-1],i=a.length>1,l=a.map(m=>m.name).join(", "),p=i?a.map(m=>m.status).includes("online"):!1;let d="";if(s){const m=s.senderId===t?"You: ":"",g=s.contentType==="image"?"Sent a photo":s.body;d=`${m}${g}`}return{group:i,displayName:l,displayText:d,participants:a,lastActivity:s.createdAt,hasOnlineInGroup:p}}function de(){const[t,o]=c.useState(!1),[n,r]=c.useState(!1),a=c.useCallback(()=>{r(p=>!p)},[]),s=c.useCallback(()=>{r(!1)},[]),i=c.useCallback(()=>{o(!0)},[]),l=c.useCallback(()=>{o(!1)},[]);return{openMobile:t,collapseDesktop:n,onOpenMobile:i,onCloseMobile:l,onCloseDesktop:s,onCollapseDesktop:a}}function us(t){const o=c.useRef(null),n=c.useCallback(()=>{t&&o.current&&o.current&&(o.current.scrollTop=o.current.scrollHeight)},[t]);return c.useEffect(()=>{n()},[t]),{messagesEndRef:o}}function he({selected:t,collapse:o,conversation:n,onCloseMobile:r}){const{user:a}=M(),s=q("up","md"),i=F(),{group:l,displayName:p,displayText:d,participants:m,lastActivity:g,hasOnlineInGroup:j}=xs({conversation:n,currentUserId:`${a==null?void 0:a.id}`}),b=m[0],{name:f,avatarUrl:S,status:L}=b,$=c.useCallback(async()=>{try{s||r(),await hs(n.id),i.push(`${N.dashboard.chat}?id=${n.id}`)}catch(O){console.error(O)}},[n.id,s,r,i]),w=e.jsx(A,{variant:j?"online":"invisible",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ce,{variant:"compact",sx:{width:48,height:48},children:m.slice(0,2).map(O=>e.jsx(C,{alt:O.name,src:O.avatarUrl},O.id))})}),G=e.jsx(A,{variant:L,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(C,{alt:f,src:S,sx:{width:48,height:48}})},L);return e.jsxs(U,{disableGutters:!0,onClick:$,sx:{py:1.5,px:2.5,...t&&{bgcolor:"action.selected"}},children:[e.jsx(A,{color:"error",overlap:"circular",badgeContent:o?n.unreadCount:0,children:l?w:G}),!o&&e.jsxs(e.Fragment,{children:[e.jsx(z,{sx:{ml:2},primary:p,primaryTypographyProps:{noWrap:!0,variant:"subtitle2"},secondary:d,secondaryTypographyProps:{noWrap:!0,component:"span",variant:n.unreadCount?"subtitle2":"body2",color:n.unreadCount?"text.primary":"text.secondary"}}),e.jsxs(x,{alignItems:"flex-end",sx:{ml:2,height:44},children:[e.jsx(k,{noWrap:!0,variant:"body2",component:"span",sx:{mb:1.5,fontSize:12,color:"text.disabled"},children:le(new Date(g),{addSuffix:!1})}),!!n.unreadCount&&e.jsx(I,{sx:{width:8,height:8,bgcolor:"info.main",borderRadius:"50%"}})]})]})]})}he.propTypes={collapse:h.bool,conversation:h.object,onCloseMobile:h.func,selected:h.bool};function ms(){const{user:t}=M(),o=Re(),[n,r]=c.useState("online"),a=c.useCallback(s=>{r(s.target.value)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(A,{variant:n,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(C,{src:t==null?void 0:t.photoURL,alt:t==null?void 0:t.displayName,onClick:o.onOpen,sx:{cursor:"pointer",width:48,height:48}})}),e.jsxs(Oe,{open:o.open,onClose:o.onClose,arrow:"top-left",sx:{p:0},children:[e.jsxs(x,{direction:"row",alignItems:"center",spacing:2,sx:{py:2,pr:1,pl:2.5},children:[e.jsx(z,{primary:t==null?void 0:t.displayName,secondary:t==null?void 0:t.email,secondaryTypographyProps:{component:"span"}}),e.jsx(Ae,{title:"Log out",children:e.jsx(y,{color:"error",children:e.jsx(u,{icon:"ic:round-power-settings-new"})})})]}),e.jsx(Le,{sx:{borderStyle:"dashed"}}),e.jsxs(x,{sx:{p:1},children:[e.jsxs(W,{children:[e.jsx(A,{variant:n,sx:{[`& .${Ne.badge}`]:{position:"static",m:.75,width:12,height:12,flexShrink:0}}}),e.jsx($e,{native:!0,fullWidth:!0,value:n,onChange:a,input:e.jsx(se,{sx:{pl:2}}),inputProps:{sx:{textTransform:"capitalize"}},children:["online","alway","busy","offline"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs(W,{children:[e.jsx(u,{icon:"solar:user-id-bold",width:24}),"Profile"]}),e.jsxs(W,{children:[e.jsx(u,{icon:"eva:settings-2-fill",width:24}),"Settings"]})]})]})]})}function pe({sx:t,...o}){return e.jsxs(x,{spacing:2,direction:"row",alignItems:"center",sx:{px:2.5,py:1.5,...t},...o,children:[e.jsx(V,{variant:"circular",sx:{width:48,height:48}}),e.jsxs(x,{spacing:1,flexGrow:1,children:[e.jsx(V,{sx:{width:.75,height:10}}),e.jsx(V,{sx:{width:.5,height:10}})]})]})}pe.propTypes={sx:h.object};function xe({query:t,results:o,onClickResult:n}){const r=o.length,a=!r&&!!t;return e.jsxs(e.Fragment,{children:[e.jsxs(k,{variant:"h6",sx:{px:2.5,mb:2},children:["Contacts (",r,")"]}),a?e.jsx(te,{query:t,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}):e.jsx(e.Fragment,{children:o.map(s=>e.jsxs(U,{onClick:()=>n(s),sx:{px:2.5,py:1.5,typography:"subtitle2"},children:[e.jsx(C,{alt:s.name,src:s.avatarUrl,sx:{mr:2}}),s.name]},s.id))})]})}xe.propTypes={query:h.string,results:h.array,onClickResult:h.func};const X=320,gs=96;function ue({loading:t,contacts:o,conversations:n,selectedConversationId:r}){const a=ne(),s=F(),i=q("up","md"),{collapseDesktop:l,onCloseDesktop:p,onCollapseDesktop:d,openMobile:m,onOpenMobile:g,onCloseMobile:j}=de(),[b,f]=c.useState({query:"",results:[]});c.useEffect(()=>{i||p()},[p,i]);const S=c.useCallback(()=>{i?d():j()},[i,j,d]),L=c.useCallback(()=>{i||j(),s.push(N.dashboard.chat)},[i,j,s]),$=c.useCallback(v=>{if(f(P=>({...P,query:v})),v){const P=o.filter(E=>E.name.toLowerCase().includes(v));f(E=>({...E,results:P}))}},[o]),w=c.useCallback(()=>{f({query:"",results:[]})},[]),G=c.useCallback(v=>{w(),s.push(`${N.dashboard.chat}?id=${v.id}`)},[w,s]),O=e.jsx(y,{onClick:g,sx:{left:0,top:84,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",bgcolor:a.palette.primary.main,boxShadow:a.customShadows.primary,color:a.palette.primary.contrastText,"&:hover":{bgcolor:a.palette.primary.darker}},children:e.jsx(u,{width:16,icon:"solar:users-group-rounded-bold"})}),we=e.jsx(e.Fragment,{children:[...Array(12)].map((v,P)=>e.jsx(pe,{},P))}),ke=e.jsx(e.Fragment,{children:n.allIds.map(v=>e.jsx(he,{collapse:l,conversation:n.byId[v],selected:v===r,onCloseMobile:j},v))}),Se=e.jsx(xe,{query:b.query,results:b.results,onClickResult:G}),Te=e.jsx(ss,{onClickAway:w,children:e.jsx(oe,{fullWidth:!0,value:b.query,onChange:v=>$(v.target.value),placeholder:`${Pe("search")}...`,InputProps:{startAdornment:e.jsx(Ue,{position:"start",children:e.jsx(u,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{mt:2.5}})}),Y=e.jsxs(e.Fragment,{children:[e.jsxs(x,{direction:"row",alignItems:"center",justifyContent:"center",sx:{p:2.5,pb:0},children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(ms,{}),e.jsx(I,{sx:{flexGrow:1}})]}),e.jsx(y,{onClick:S,children:e.jsx(u,{icon:l?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!l&&e.jsx(y,{onClick:L,children:e.jsx(u,{width:24,icon:"solar:user-plus-bold"})})]}),e.jsx(I,{sx:{p:2.5,pt:0},children:!l&&Te}),e.jsxs(H,{sx:{pb:1},children:[b.query&&Se,t&&we,!b.query&&!!n.allIds.length&&ke]})]});return e.jsxs(e.Fragment,{children:[!i&&O,i?e.jsx(x,{sx:{height:1,flexShrink:0,width:X,borderRight:`solid 1px ${a.palette.divider}`,transition:a.transitions.create(["width"],{duration:a.transitions.duration.shorter}),...l&&{width:gs}},children:Y}):e.jsx(re,{open:m,onClose:j,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:X}},children:Y})]})}ue.propTypes={contacts:h.array,conversations:h.object,loading:h.bool,selectedConversationId:h.string};var Z=Me,js=De,fs=Fe,ee=Z?Z.isConcatSpreadable:void 0;function bs(t){return fs(t)||js(t)||!!(ee&&t&&t[ee])}var ys=bs,vs=ze,Cs=ys;function me(t,o,n,r,a){var s=-1,i=t.length;for(n||(n=Cs),a||(a=[]);++s<i;){var l=t[s];o>0&&n(l)?o>1?me(l,o-1,n,r,a):vs(a,l):r||(a[a.length]=l)}return a}var ws=me,ks=ws;function Ss(t){var o=t==null?0:t.length;return o?ks(t,1):[]}var Ts=Ss;const Is=Ge(Ts);function ge({participant:t,open:o,onClose:n}){return e.jsxs(Ee,{fullWidth:!0,maxWidth:"xs",open:o,onClose:n,children:[e.jsx(y,{onClick:n,sx:{position:"absolute",right:8,top:8},children:e.jsx(u,{icon:"mingcute:close-line"})}),e.jsxs(ts,{sx:{py:5,px:3,display:"flex"},children:[e.jsx(C,{alt:t.name,src:t.avatarUrl,sx:{width:96,height:96,mr:3}}),e.jsxs(x,{spacing:1,children:[e.jsx(k,{variant:"caption",sx:{color:"primary.main"},children:t.role}),e.jsx(k,{variant:"subtitle1",children:t.name}),e.jsxs(x,{direction:"row",sx:{typography:"caption",color:"text.disabled"},children:[e.jsx(u,{icon:"mingcute:location-fill",width:16,sx:{flexShrink:0,mr:.5,mt:"2px"}}),t.address]}),e.jsxs(x,{spacing:1,direction:"row",sx:{pt:1.5},children:[e.jsx(y,{size:"small",color:"error",sx:{borderRadius:1,bgcolor:r=>T(r.palette.error.main,.08),"&:hover":{bgcolor:r=>T(r.palette.error.main,.16)}},children:e.jsx(u,{width:18,icon:"solar:phone-bold"})}),e.jsx(y,{size:"small",color:"info",sx:{borderRadius:1,bgcolor:r=>T(r.palette.info.main,.08),"&:hover":{bgcolor:r=>T(r.palette.info.main,.16)}},children:e.jsx(u,{width:18,icon:"solar:chat-round-dots-bold"})}),e.jsx(y,{size:"small",color:"primary",sx:{borderRadius:1,bgcolor:r=>T(r.palette.primary.main,.08),"&:hover":{bgcolor:r=>T(r.palette.primary.main,.16)}},children:e.jsx(u,{width:18,icon:"fluent:mail-24-filled"})}),e.jsx(y,{size:"small",color:"secondary",sx:{borderRadius:1,bgcolor:r=>T(r.palette.secondary.main,.08),"&:hover":{bgcolor:r=>T(r.palette.secondary.main,.16)}},children:e.jsx(u,{width:18,icon:"solar:videocamera-record-bold"})})]})]})]})]})}ge.propTypes={onClose:h.func,open:h.bool,participant:h.object};function je({participants:t}){const[o,n]=c.useState(null),r=ae(!0),a=c.useCallback(d=>{n(d)},[]),s=()=>{n(null)},i=t.length,l=e.jsxs(U,{onClick:r.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(I,{component:"span",sx:{flexGrow:1},children:["In room (",i,")"]}),e.jsx(u,{width:16,icon:r.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),p=e.jsx(H,{sx:{height:56*4},children:t.map(d=>e.jsxs(U,{onClick:()=>a(d),children:[e.jsx(A,{variant:d.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(C,{alt:d.name,src:d.avatarUrl})}),e.jsx(z,{sx:{ml:2},primary:d.name,secondary:d.role,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0,component:"span",typography:"caption"}})]},d.id))});return e.jsxs(e.Fragment,{children:[l,e.jsx("div",{children:e.jsx(ie,{in:r.value,children:p})}),o&&e.jsx(ge,{participant:o,open:!!o,onClose:s})]})}je.propTypes={participants:h.array};function fe({participant:t}){const o=ae(!0),{name:n,avatarUrl:r,role:a,address:s,phoneNumber:i,email:l}=t,p=e.jsxs(x,{alignItems:"center",sx:{py:5},children:[e.jsx(C,{alt:n,src:r,sx:{width:96,height:96,mb:2}}),e.jsx(k,{variant:"subtitle1",children:n}),e.jsx(k,{variant:"body2",sx:{color:"text.secondary",mt:.5},children:a})]}),d=e.jsxs(U,{onClick:o.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsx(I,{component:"span",sx:{flexGrow:1},children:"Information"}),e.jsx(u,{width:16,icon:o.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),m=e.jsxs(x,{spacing:2,sx:{px:2,py:2.5,"& svg":{mr:1,flexShrink:0,color:"text.disabled"}},children:[e.jsxs(x,{direction:"row",children:[e.jsx(u,{icon:"mingcute:location-fill"}),e.jsx(k,{variant:"body2",children:s})]}),e.jsxs(x,{direction:"row",children:[e.jsx(u,{icon:"solar:phone-bold"}),e.jsx(k,{variant:"body2",children:i})]}),e.jsxs(x,{direction:"row",children:[e.jsx(u,{icon:"fluent:mail-24-filled"}),e.jsx(k,{variant:"body2",noWrap:!0,children:l})]})]});return e.jsxs(e.Fragment,{children:[p,d,e.jsx("div",{children:e.jsx(ie,{in:o.value,children:m})})]})}fe.propTypes={participant:h.object};h.array;const B=240;function be({participants:t,conversation:o}){const n=ne(),r=q("up","lg"),{collapseDesktop:a,onCloseDesktop:s,onCollapseDesktop:i,openMobile:l,onOpenMobile:p,onCloseMobile:d}=de();c.useEffect(()=>{r||s()},[s,r]);const m=c.useCallback(()=>{r?i():p()},[r]),g=t.length>1;We(Is(o.messages.map(f=>f.attachments)));const j=e.jsx(e.Fragment,{children:g?e.jsx(je,{participants:t}):e.jsx(fe,{participant:t[0]})}),b=e.jsx(y,{onClick:m,sx:{top:12,right:0,zIndex:9,width:32,height:32,borderRight:0,position:"absolute",borderRadius:"12px 0 0 12px",boxShadow:n.customShadows.z8,bgcolor:n.palette.background.paper,border:`solid 1px ${n.palette.divider}`,"&:hover":{bgcolor:n.palette.background.neutral},...r&&{...!a&&{right:B}}},children:r?e.jsx(u,{width:16,icon:a?"eva:arrow-ios-back-fill":"eva:arrow-ios-forward-fill"}):e.jsx(u,{width:16,icon:"eva:arrow-ios-back-fill"})});return e.jsxs(I,{sx:{position:"relative"},children:[b,r?e.jsx(x,{sx:{height:1,flexShrink:0,width:B,borderLeft:`solid 1px ${n.palette.divider}`,transition:n.transitions.create(["width"],{duration:n.transitions.duration.shorter}),...a&&{width:0}},children:!a&&j}):e.jsx(re,{anchor:"right",open:l,onClose:d,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:B}},children:j})]})}be.propTypes={conversation:h.object,participants:h.array};function ye({message:t,participants:o,onOpenLightbox:n}){const{user:r}=M(),{me:a,senderDetails:s,hasImage:i}=ps({message:t,participants:o,currentUserId:`${r==null?void 0:r.id}`}),{firstName:l,avatarUrl:p}=s,{body:d,createdAt:m}=t,g=e.jsxs(k,{noWrap:!0,variant:"caption",sx:{mb:1,color:"text.disabled",...!a&&{mr:"auto"}},children:[!a&&`${l},`,"  ",le(new Date(m),{addSuffix:!0})]}),j=e.jsx(x,{sx:{p:1.5,minWidth:48,maxWidth:320,borderRadius:1,typography:"body2",bgcolor:"background.neutral",...a&&{color:"grey.800",bgcolor:"primary.lighter"},...i&&{p:0,bgcolor:"transparent"}},children:i?e.jsx(I,{component:"img",alt:"attachment",src:d,onClick:()=>n(d),sx:{minHeight:220,borderRadius:1.5,cursor:"pointer","&:hover":{opacity:.9}}}):d}),b=e.jsxs(x,{direction:"row",className:"message-actions",sx:{pt:.5,opacity:0,top:"100%",left:0,position:"absolute",transition:f=>f.transitions.create(["opacity"],{duration:f.transitions.duration.shorter}),...a&&{left:"unset",right:0}},children:[e.jsx(y,{size:"small",children:e.jsx(u,{icon:"solar:reply-bold",width:16})}),e.jsx(y,{size:"small",children:e.jsx(u,{icon:"eva:smiling-face-fill",width:16})}),e.jsx(y,{size:"small",children:e.jsx(u,{icon:"solar:trash-bin-trash-bold",width:16})})]});return e.jsxs(x,{direction:"row",justifyContent:a?"flex-end":"unset",sx:{mb:5},children:[!a&&e.jsx(C,{alt:l,src:p,sx:{width:32,height:32,mr:2}}),e.jsxs(x,{alignItems:"flex-end",children:[g,e.jsxs(x,{direction:"row",alignItems:"center",sx:{position:"relative","&:hover":{"& .message-actions":{opacity:1}}},children:[j,b]})]})]})}ye.propTypes={message:h.object,onOpenLightbox:h.func,participants:h.array};function ve({messages:t=[],participants:o}){const{messagesEndRef:n}=us(t),r=t.filter(s=>s.contentType==="image").map(s=>({src:s.body})),a=ns(r);return e.jsxs(e.Fragment,{children:[e.jsx(H,{ref:n,sx:{px:3,py:5,height:1},children:e.jsx(I,{children:t.map(s=>e.jsx(ye,{message:s,participants:o,onOpenLightbox:()=>a.onOpen(s.body)},s.id))})}),e.jsx(os,{index:a.selected,slides:r,open:a.open,close:a.onClose})]})}ve.propTypes={messages:h.array,participants:h.array};function Ce({recipients:t,onAddRecipients:o,disabled:n,selectedConversationId:r}){const a=F(),{user:s}=M(),i=c.useRef(null),[l,p]=c.useState(""),d=c.useMemo(()=>({id:`${s==null?void 0:s.id}`,role:`${s==null?void 0:s.role}`,email:`${s==null?void 0:s.email}`,address:`${s==null?void 0:s.address}`,name:`${s==null?void 0:s.displayName}`,lastActivity:new Date,avatarUrl:`${s==null?void 0:s.photoURL}`,phoneNumber:`${s==null?void 0:s.phoneNumber}`,status:"online"}),[s]),m=c.useMemo(()=>({id:J(),attachments:[],body:l,contentType:"text",createdAt:Ve(new Date,{minutes:1}),senderId:d.id}),[l,d.id]),g=c.useMemo(()=>({id:J(),messages:[m],participants:[...t,d],type:t.length>1?"GROUP":"ONE_TO_ONE",unreadCount:0}),[m,d,t]);c.useCallback(()=>{i.current&&i.current.click()},[]);const j=c.useCallback(f=>{p(f.target.value)},[]),b=c.useCallback(async f=>{try{if(f.key==="Enter"){if(l)if(r)await cs(r,m);else{const S=await ds(g);a.push(`${N.dashboard.chat}?id=${S.conversation.id}`),o([])}p("")}}catch(S){console.error(S)}},[g,l,m,o,a,r]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{value:l,onKeyUp:b,onChange:j,placeholder:"Type a message",disabled:n,endAdornment:e.jsx(x,{direction:"row",sx:{flexShrink:0}}),sx:{px:1,height:56,flexShrink:0,borderTop:f=>`solid 1px ${f.palette.divider}`}}),e.jsx("input",{type:"file",ref:i,style:{display:"none"}})]})}Ce.propTypes={disabled:h.bool,onAddRecipients:h.func,recipients:h.array,selectedConversationId:h.string};function Rs({participants:t}){const o=t.length>1,n=t[0],r=e.jsx(ce,{max:3,sx:{[`& .${Be.avatar}`]:{width:32,height:32}},children:t.map(s=>e.jsx(C,{alt:s.name,src:s.avatarUrl},s.id))}),a=e.jsxs(x,{flexGrow:1,direction:"row",alignItems:"center",spacing:2,children:[e.jsx(A,{variant:n.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(C,{src:n.avatarUrl,alt:n.name})}),e.jsx(z,{primary:n.name,secondary:n.status==="offline"?_e(n.lastActivity):n.status,secondaryTypographyProps:{component:"span",...n.status!=="offline"&&{textTransform:"capitalize"}}})]});return e.jsxs(e.Fragment,{children:[o?r:a,e.jsx(x,{flexGrow:1}),e.jsx(y,{children:e.jsx(u,{icon:"solar:phone-bold"})}),e.jsx(y,{children:e.jsx(u,{icon:"solar:videocamera-record-bold"})}),e.jsx(y,{children:e.jsx(u,{icon:"eva:more-vertical-fill"})})]})}Rs.propTypes={participants:h.array};function Os({contacts:t,onAddRecipients:o}){const[n,r]=c.useState(""),a=c.useCallback(s=>{r(""),o(s)},[o]);return e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),e.jsx(qe,{sx:{minWidth:320},multiple:!0,limitTags:3,popupIcon:null,disableCloseOnSelect:!0,noOptionsText:e.jsx(te,{query:n}),onChange:(s,i)=>a(i),onInputChange:(s,i)=>r(i),options:t,getOptionLabel:s=>s.name,isOptionEqualToValue:(s,i)=>s.id===i.id,renderInput:s=>e.jsx(oe,{...s,placeholder:"+ Recipients"}),renderOption:(s,i,{selected:l})=>c.createElement("li",{...s,key:i.id},e.jsxs(I,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[e.jsx(C,{alt:i.name,src:i.avatarUrl,sx:{width:1,height:1}}),e.jsx(x,{alignItems:"center",justifyContent:"center",sx:{top:0,left:0,width:1,height:1,opacity:0,position:"absolute",bgcolor:p=>T(p.palette.grey[900],.8),transition:p=>p.transitions.create(["opacity"],{easing:p.transitions.easing.easeInOut,duration:p.transitions.duration.shorter}),...l&&{opacity:1,color:"primary.main"}},children:e.jsx(u,{icon:"eva:checkmark-fill"})})]},i.id),i.name),renderTags:(s,i)=>s.map((l,p)=>c.createElement(He,{...i({index:p}),key:l.id,label:l.name,avatar:e.jsx(C,{alt:l.name,src:l.avatarUrl}),size:"small",variant:"soft"}))})]})}Os.propTypes={contacts:h.array,onAddRecipients:h.func};function As(){const t=F(),{t:o}=Ke(),{user:n}=M(),r=Qe(),s=Ye().get("id")||"",[i,l]=c.useState([]),{contacts:p}=as(),{conversations:d,conversationsLoading:m}=is(),{conversation:g,conversationError:j}=ls(`${s}`),b=g?g.participants.filter(w=>w.id!==`${n.id}`):[];c.useEffect(()=>{(j||!s)&&t.push(N.dashboard.chat)},[j,t,s]);const f=c.useCallback(w=>{l(w)},[]),S=!!g,L=e.jsx(ue,{contacts:p,conversations:d,loading:m,selectedConversationId:s}),$=e.jsxs(x,{sx:{width:1,height:1,overflow:"hidden"},children:[e.jsx(ve,{messages:g==null?void 0:g.messages,participants:b}),e.jsx(Ce,{recipients:i,onAddRecipients:f,selectedConversationId:s,disabled:!i.length&&!s})]});return e.jsxs(Je,{maxWidth:r.themeStretch?!1:"xl",children:[e.jsx(rs,{heading:o("technical-support"),links:[{name:o("dashboard"),href:N.dashboard.root},{name:o("technical-support")}],sx:{mb:{xs:3,md:5}}}),e.jsxs(x,{component:Xe,direction:"row",sx:{height:"72vh"},children:[L,e.jsx(x,{sx:{width:1,height:1,overflow:"hidden"},children:e.jsxs(x,{direction:"row",sx:{width:1,height:1,overflow:"hidden",borderTop:w=>`solid 1px ${w.palette.divider}`},children:[$,S&&e.jsx(be,{conversation:g,participants:b})]})})]})]})}function _s(){return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{children:e.jsx("title",{children:" Dashboard: Chat"})}),e.jsx(As,{})]})}export{_s as default};
