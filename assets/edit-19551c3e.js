import{r as n,aY as Q,cH as U,aL as Z,j as t,B as d,eN as ee,T as k,N as te,m as ae,eO as re,I as ie,aK as l,n as oe,O as _,aQ as N,aO as se,aP as ne,aR as de,aS as ce,W as le,p as H,c as he,aN as xe}from"./index-b75d89b7.js";import{C as pe}from"./custom-breadcrumbs-e6b049c1.js";import{u as fe,c as ue,v as ge,h as be,l as me,r as ye,t as we,b as ke,a as Ce}from"./getTablesData-bd9fc92d.js";import"./axios_config-2d29f5b4.js";const je=n.forwardRef((p,u)=>{const a=JSON.parse(localStorage.getItem("settings")),{data:o,isLoading:C,error:De}=fe(),T={width:(o==null?void 0:o.boardWidth)||1100,height:(o==null?void 0:o.boardHeight)||650},A=Q(),[g,L]=n.useState(!1),[j,X]=n.useState(!1),R=()=>{L(!g)},$=()=>{X(!j)},[h,ve]=n.useState([{name:"circle-table",content:"⭕",key:"Circle Table",img:ue},{name:"vertical-table",content:"◼️",key:"Vertical Table",img:ge},{name:"rec-table",content:"◼️",key:"Horizontal Table",img:be},{name:"left-chair",content:"🪑",key:"Left Chair",img:me},{name:"right-chair",content:"🪑",key:"Right Chair",img:ye},{name:"top-chair",content:"🪑",key:"Top Chair",img:we},{name:"bottom-chair",content:"🪑",key:"Bottom Chair",img:ke}]),[b,m]=n.useState((o==null?void 0:o.assets)||[]),[c,z]=n.useState(T),[B,Y]=n.useState([]),I=(e,i)=>{const r=e.clientX-e.target.getBoundingClientRect().left,s=e.clientY-e.target.getBoundingClientRect().top;e.dataTransfer.setData("text",i),e.dataTransfer.setData("offsetX",r),e.dataTransfer.setData("offsetY",s)},O=e=>{e.preventDefault();const i=e.dataTransfer.getData("text"),r=parseFloat(e.dataTransfer.getData("offsetX")),s=parseFloat(e.dataTransfer.getData("offsetY")),D=e.currentTarget.getBoundingClientRect();let f,y;N.language==="ar"?f=D.right-e.clientX-r+window.scrollX:f=e.clientX-D.left-r+window.scrollX,y=e.clientY-D.top-s+window.scrollY;const G=c.width-30,K=c.height-30;if(f=Math.min(Math.max(f,0),G),y=Math.min(Math.max(y,0),K),h.some(x=>x.name===i)){const x=h.find(v=>v.name===i),w=x.key.includes("Chair");m(v=>[...v,{name:`copy_${Math.random().toString(36).substring(2,9)}`,content:x.content,x:f,y,img:x.img,key:x.key,...w?{nfc_number:""}:{}}])}else m(x=>x.map(w=>w.name===i?{...w,x:f,y}:w))},F=(e,i)=>{m(r=>r.map(s=>s.name===e&&s.key.includes("Chair")?{...s,nfc_number:i||""}:s))},E=(e,i)=>{z({width:e,height:i})},P=e=>{m(i=>i.filter(r=>r.name!==e))};n.useEffect(()=>{m(o==null?void 0:o.assets),z(T)},[o]),n.useEffect(()=>{Y(b)},[b,c]);const W=window.localStorage.getItem("user_data"),S=U(W),q=()=>{for(const e of B)for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];if(!r||r==="")return R(),!1}return!0},{mutate:J,error:Te,isError:Re,isLoading:M}=Z({mutationFn:e=>se.post(`${ne}dashboard/restaurant/tables/create`,e,{headers:{"Content-Type":"multipart/form-data","Accept-Language":N.language,Authorization:`Bearer ${S==null?void 0:S.token}`}}),onSuccess:()=>{de(l("tables-seccess")),A("/dashboard/tables/list")},onError:()=>{ce(l("error"))}}),V=()=>{const e=new FormData;if(B.forEach((i,r)=>{Object.keys(i).forEach(s=>{e.append(`assets[${r}][${s}]`,s==="nfc_number"?parseInt(i[s]):i[s])})}),e.append("boardWidth",c.width),e.append("boardHeight",c.height),q())J(e);else{alert(l("num-required"));return}};return n.useEffect(()=>{M?p.setLoading(!0):p.setLoading(!1)},[M]),n.useImperativeHandle(u,()=>({saveData:V})),t.jsxs(d,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsx(d,{sx:{position:"fixed",zIndex:"1102",top:0,left:0,width:"100%",height:"100%",background:"#00000078",visibility:C?"":"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx(ee,{})}),t.jsxs(d,{sx:{display:"flex",width:"100%"},children:[t.jsxs(d,{sx:{position:"sticky",top:"70px",left:"0",height:"max-content",margin:"0px 15px",width:"110px",border:"1px solid white",borderRadius:"10px",padding:"10px",borderColor:(a==null?void 0:a.themeMode)==="dark"?"#ffffff":"#161C24",zIndex:"1"},children:[h==null?void 0:h.map((e,i)=>t.jsxs(d,{draggable:!0,sx:{borderRadius:"5px",cursor:"grab",width:"90px",maxHeight:"auto",border:"1px solid white",borderColor:(a==null?void 0:a.themeMode)==="dark"?"#ffffff":"#161C24",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginBottom:"20px",textAlign:"center",padding:"3px"},onDragStart:r=>I(r,e.name),children:[t.jsx(k,{fontSize:"40px",children:e.content}),t.jsx(k,{fontSize:"12px",mt:-2,children:e.key})]},`element-${e.name}`)),t.jsxs(d,{sx:{position:"relative",padding:" 10px",border:"1px solid white",borderColor:(a==null?void 0:a.themeMode)==="dark"?"#ffffff":"#161C24",borderRadius:"5px",width:"100%",display:"flex",justifyContent:"center"},children:[t.jsx(te,{component:ae.button,whileTap:"tap",whileHover:"hover",variants:re(1.05),"aria-label":"settings",onClick:$,sx:{width:40,height:40},children:t.jsx(ie,{icon:"solar:settings-bold-duotone",width:24})}),t.jsxs(d,{sx:{position:"absolute",right:"-225px",bottom:"35px",zIndex:"1000",width:"250px",background:(a==null?void 0:a.themeMode)==="dark"?"#181818":"#e0e0e0",padding:"10px",borderRadius:"10px",transition:"0.4s",visibility:j?"":"hidden",opacity:j?"1":"0"},children:[t.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid white",borderColor:(a==null?void 0:a.themeMode)==="dark"?"#ffffff":"#161C24",padding:"5px",borderRadius:"10px"},children:[t.jsx(k,{fontSize:"12px",children:l("add-chair-num")}),t.jsx(oe,{onChange:R,checked:g&&!0})]}),t.jsx(_,{sx:{my:"20px",width:"100%"},label:"Width",variant:"outlined",type:"number",value:c.width,onChange:e=>E(Number(e.target.value),c.height)}),t.jsx(_,{label:"Height",variant:"outlined",type:"number",sx:{width:"100%"},value:c.height,onChange:e=>E(c.width,Number(e.target.value))})]})]})]}),t.jsx(d,{sx:{overflow:"auto",border:"1px solid white",borderRadius:"5px",backgroundImage:`url(${Ce})`,backgroundSize:"cover",backgroundRepeat:"no-repeat",borderColor:(a==null?void 0:a.themeMode)==="dark"?"white":"#161C24",backgroundPosition:"center",height:"max-content",zIndex:"0","&::-webkit-scrollbar":{width:"6px",height:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"grey",borderRadius:"20px"},"&::-webkit-scrollbar-track":{backgroundColor:"#ffffff19"},mx:{xs:"20p !important",md:"10px",lg:"0px"}},onDragOver:e=>e.preventDefault(),onDrop:O,children:t.jsx(d,{sx:{width:c.width+"px",height:c.height+"px",position:"relative",borderRadius:"10px"},children:b==null?void 0:b.map((e,i)=>t.jsxs(d,{sx:{position:"absolute",top:e.y+"px",border:"1px solid white",borderRadius:"5px",borderColor:(a==null?void 0:a.themeMode)==="dark"?"#ffffff":"#161C24",textAlign:"center",padding:e.key==="Vertical Table"?"50px 3px":"3px",":hover":{cursor:"move"},left:e.x+"px"},draggable:"true",onDragStart:r=>I(r,e.name),onDoubleClick:()=>{!g&&P(e.name)},children:[h==null?void 0:h.map(r=>r.key===e.key&&t.jsx(k,{fontSize:"40px",sx:{width:r.key==="Horizontal Table"?"150px":""},children:r.content},`element-${e.name||i}`)),e.key.includes("Chair")&&t.jsx(d,{sx:{position:"absolute",top:0,right:"-105px",textAlign:"center",zIndex:100,transition:"0.4s",display:g?"":"none",opacity:g?"1":"0"},children:t.jsx("input",{size:"small",value:e.nfc_number||"",type:"number",id:"nfc_num",required:!0,style:{textAlign:"center",width:"100px",padding:"10px",border:"1px solid white",borderRadius:"5px",outline:"none",background:"white",color:"#161C24"},onChange:r=>F(e.name,r.target.value),placeholder:"Chair Number"})}),t.jsx(k,{fontSize:"10px",mt:-2,children:e.key})]},`element-${e.name}`))})})]})]})}),Se=je;function _e(){const p=n.useRef(),u=JSON.parse(localStorage.getItem("settings")),[a,o]=n.useState(!1),C=()=>{p.current&&p.current.saveData()};return t.jsxs(t.Fragment,{children:[t.jsx(le,{children:t.jsx("title",{children:" Dashboard: Edit Tables"})}),t.jsx(pe,{heading:l("edit")+" "+l("tables"),links:[{name:l("dashboard"),href:H.dashboard.root},{name:l("tables"),href:H.dashboard.tables.list},{name:l("edit")}],action:t.jsx(he,{variant:"contained",onClick:C,children:a?t.jsx(xe,{color:(u==null?void 0:u.themeMode)==="dark"?"#161C24":"#ffffff",size:23}):l("save-changes")}),sx:{mb:{xs:3,md:5}}}),t.jsx(Se,{ref:p,setLoading:o})]})}export{_e as default};
