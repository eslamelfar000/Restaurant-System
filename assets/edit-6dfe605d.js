import{r as n,aY as q,cH as J,aL as G,j as e,B as l,eN as K,T as y,aK as c,n as Q,O as _,aQ as I,aO as U,aP as Z,aR as tt,aS as et,W as at,p as M,c as rt,aN as it}from"./index-186823c6.js";import{C as ot}from"./custom-breadcrumbs-cb6ff524.js";import{u as st,c as nt,v as dt,h as lt,l as ct,r as ht,t as ft,b as gt,a as pt}from"./getTablesData-075accd7.js";import"./axios_config-9ec68672.js";const ut=n.forwardRef((g,u)=>{const i=JSON.parse(localStorage.getItem("settings")),{data:o,isLoading:w,error:bt}=st(),T={width:(o==null?void 0:o.boardWidth)||1100,height:(o==null?void 0:o.boardHeight)||650},N=q(),[D,A]=n.useState(!1),R=()=>{A(!D)},[k,mt]=n.useState([{id:"circle-table",content:"â­•",key:"Circle Table",img:nt},{id:"vertical-table",content:"â—¼ï¸",key:"Vertical Table",img:dt},{id:"rec-table",content:"â—¼ï¸",key:"Horizontal Table",img:lt},{id:"left-chair",content:"ðŸª‘",key:"Left Chair",img:ct},{id:"right-chair",content:"ðŸª‘",key:"Right Chair",img:ht},{id:"top-chair",content:"ðŸª‘",key:"Top Chair",img:ft},{id:"bottom-chair",content:"ðŸª‘",key:"Bottom Chair",img:gt}]),[x,b]=n.useState((o==null?void 0:o.assets)||[]),[d,v]=n.useState(T),[C,L]=n.useState([]),E=(t,r)=>{const a=t.clientX-t.target.getBoundingClientRect().left,s=t.clientY-t.target.getBoundingClientRect().top;t.dataTransfer.setData("text",r),t.dataTransfer.setData("offsetX",a),t.dataTransfer.setData("offsetY",s)},X=t=>{t.preventDefault(),console.log("Drop event:",t);const r=t.dataTransfer.getData("text"),a=parseFloat(t.dataTransfer.getData("offsetX")),s=parseFloat(t.dataTransfer.getData("offsetY")),S=t.currentTarget.getBoundingClientRect();let p,m;I.language==="ar"?p=S.right-t.clientX-a+window.scrollX:p=t.clientX-S.left-a+window.scrollX,m=t.clientY-S.top-s+window.scrollY;const W=d.width-30,V=d.height-30;if(p=Math.min(Math.max(p,0),W),m=Math.min(Math.max(m,0),V),k.some(h=>h.id===r)){const h=k.find(f=>f.id===r);b(f=>[...f,{id:`copy_${Math.random().toString(36).substring(2,9)}`,content:h.content,x:p,y:m,img:h.img,key:h.key,nfc_number:""}])}else b(h=>h.map(f=>f.id===r?{...f,x:p,y:m}:f))},$=(t,r)=>{b(a=>a.map(s=>s.id===t&&s.key.includes("Chair")?{...s,nfc_number:r||""}:s))},z=(t,r)=>{v({width:t,height:r})},H=t=>{b(r=>r.filter(a=>a.id!==t))};n.useEffect(()=>{b(o==null?void 0:o.assets),v(T)},[o]),n.useEffect(()=>{L(x)},[x,d]),console.log(C);const Y=window.localStorage.getItem("user_data"),j=J(Y),{mutate:F,error:yt,isError:kt,isLoading:B}=G({mutationFn:t=>U.post(`${Z}dashboard/restaurant/tables/create`,t,{headers:{"Content-Type":"multipart/form-data","Accept-Language":I.language,Authorization:`Bearer ${j==null?void 0:j.token}`}}),onSuccess:()=>{tt(c("tables-seccess")),N("/dashboard/tables/list")},onError:()=>{et(c("error"))}}),O=()=>{console.log("Validating form data",C);for(const t of C)for(const r in t)if(t.hasOwnProperty(r)){const a=t[r];if(!a||a==="")return R(),!1}return!0},P=()=>{const t=new FormData;if(C.forEach((r,a)=>{Object.keys(r).forEach(s=>{t.append(`assets[${a}][${s}]`,s==="nfc_number"?parseInt(r[s]):r[s])})}),t.append("boardWidth",d.width),t.append("boardHeight",d.height),O())F(t);else{alert(c("num-required"));return}};return n.useEffect(()=>{B?g.setLoading(!0):g.setLoading(!1)},[B]),n.useImperativeHandle(u,()=>({saveData:P})),e.jsxs(l,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(l,{sx:{position:"fixed",zIndex:"1102",top:0,left:0,width:"100%",height:"100%",background:"#00000078",visibility:w?"":"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(K,{})}),e.jsxs(l,{sx:{display:"flex",width:"100%"},children:[e.jsxs(l,{sx:{position:"sticky",top:"70px",left:"0",height:"max-content",margin:"0px 15px",width:"110px",border:"1px solid white",borderRadius:"10px",padding:"10px",borderColor:(i==null?void 0:i.themeMode)==="dark"?"#ffffff":"#161C24",display:"flex",flexDirection:"column",alignItems:"center"},children:[k.map((t,r)=>e.jsxs(l,{draggable:!0,sx:{borderRadius:"5px",cursor:"grab",width:"90px",maxHeight:"auto",border:"1px solid white",borderColor:(i==null?void 0:i.themeMode)==="dark"?"#ffffff":"#161C24",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",":not(:nth-of-type(7))":{marginBottom:"20px"},textAlign:"center",padding:"3px"},onDragStart:a=>E(a,t.id),children:[e.jsx(y,{fontSize:"40px",children:t.content}),e.jsx(y,{fontSize:"12px",mt:-2,children:t.key})]},`element-${t.id||r}`)),e.jsxs(l,{sx:{position:"fixed",left:"10px",bottom:"10px"},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",border:"1px solid white",borderColor:(i==null?void 0:i.themeMode)==="dark"?"#ffffff":"#161C24",padding:"5px",borderRadius:"10px"},children:[e.jsx(y,{fontSize:"12px",children:c("add-chair-num")}),e.jsx(Q,{onChange:R})]}),e.jsx(_,{sx:{my:"20px",display:"block"},label:"Width",variant:"outlined",type:"number",value:d.width,onChange:t=>z(Number(t.target.value),d.height)}),e.jsx(_,{label:"Height",variant:"outlined",type:"number",value:d.height,onChange:t=>z(d.width,Number(t.target.value))})]})]}),e.jsx(l,{sx:{overflow:"auto",border:"1px solid white",borderRadius:"5px",backgroundImage:`url(${pt})`,backgroundSize:"cover",backgroundRepeat:"no-repeat",borderColor:(i==null?void 0:i.themeMode)==="dark"?"white":"#161C24",backgroundPosition:"center",height:"max-content","&::-webkit-scrollbar":{width:"6px",height:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"grey",borderRadius:"20px"},"&::-webkit-scrollbar-track":{backgroundColor:"#ffffff19"}},onDragOver:t=>t.preventDefault(),onDrop:X,children:e.jsx(l,{sx:{width:d.width+"px",height:d.height+"px",position:"relative",borderRadius:"10px",margin:{xs:"20p !important",md:"10px"}},children:x==null?void 0:x.map((t,r)=>e.jsxs(l,{sx:{position:"absolute",top:t.y+"px",border:"1px solid white",borderRadius:"5px",borderColor:(i==null?void 0:i.themeMode)==="dark"?"#ffffff":"#161C24",textAlign:"center",padding:"3px",":hover":{cursor:"move"},left:t.x+"px"},draggable:!0,onDragStart:a=>E(a,t.id),onDoubleClick:()=>H(t.id),children:[k.map(a=>a.key===t.key&&e.jsx(y,{fontSize:"40px",sx:{width:a.key==="Horizontal Table"?"150px":"",height:a.key==="Vertical Table"?"150px":""},children:a.content},`element-${t.id||r}`)),e.jsx(l,{sx:{position:"absolute",top:0,right:"-105px",textAlign:"center"},children:t.key.includes("Chair")&&e.jsx("input",{size:"small",value:t.nfc_number||"",type:"number",id:"nfc_num",required:!0,style:{textAlign:"center",width:"100px",padding:"10px",border:"1px solid white",borderRadius:"5px",outline:"none",background:"white",color:"#161C24",transition:"0.4s",visibility:D?"":"hidden",opacity:D?"1":"0"},onChange:a=>$(t.id,a.target.value),placeholder:"Chair Number"})}),e.jsx(y,{fontSize:"10px",mt:-2,children:t.key})]},`element-${t.id||r}`))})})]})]})}),xt=ut;function Tt(){const g=n.useRef(),u=JSON.parse(localStorage.getItem("settings")),[i,o]=n.useState(!1),w=()=>{g.current&&g.current.saveData()};return e.jsxs(e.Fragment,{children:[e.jsx(at,{children:e.jsx("title",{children:" Dashboard: Edit Tables"})}),e.jsx(ot,{heading:c("edit")+" "+c("tables"),links:[{name:c("dashboard"),href:M.dashboard.root},{name:c("tables"),href:M.dashboard.tables.list},{name:c("edit")}],action:e.jsx(rt,{variant:"contained",onClick:w,children:i?e.jsx(it,{color:(u==null?void 0:u.themeMode)==="dark"?"#161C24":"#ffffff",size:23}):c("save-changes")}),sx:{mb:{xs:3,md:5}}}),e.jsx(xt,{ref:g,setLoading:o})]})}export{Tt as default};
