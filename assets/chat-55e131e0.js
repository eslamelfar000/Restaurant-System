import{cH as et,cI as rt,r as c,eA as ct,f7 as V,aP as O,aQ as $,aS as D,aK as C,P as d,du as B,u as lt,aT as H,p as G,j as t,z as W,A as S,a6 as dt,ad as pt,c3 as At,S as x,T as E,cp as ht,a as Lt,aL as ut,N as R,I as w,B as k,O as Z,$ as vt,c as Rt,aN as $t,aw as xt,a5 as Et,aO as gt,aR as Ot,d3 as Ft,eO as Mt,f8 as Nt,ct as _t,bG as zt,dA as Bt,co as Pt,e as qt,x as Ut,cG as Gt,l as Wt,aU as Vt,C as Dt,h as Ht,W as Jt}from"./index-7ea3d364.js";import"./_baseToString-0d1adebe.js";import{m as Kt}from"./index-2c54f451.js";import{S as Y}from"./Skeleton-14119312.js";import{C as Qt}from"./ClickAwayListener-42b2f85c.js";import{u as Xt,L as Yt}from"./lightbox-22f71e04.js";import{u as st}from"./uuidv4-bea31cbe.js";import{L as Zt}from"./LoadingButton-98b7bd41.js";import{A as te}from"./AvatarGroup-c9a0f657.js";import{C as ee}from"./custom-breadcrumbs-e932d3ce.js";import"./CircularProgress-4dfa33e2.js";const re=window.localStorage.getItem("user_data"),m=et(re);function ae(){const{data:e,isLoading:s,error:r,refetch:o,isValidating:a}=rt(["contacts"],{queryFn:()=>V.get(`${O}dashboard/restaurant/tickets/list`,{headers:{"Content-Type":"application/json","Accept-Language":$.language,Authorization:`Bearer ${m==null?void 0:m.token}`}}),onSuccess:i=>{},onError:()=>{D(C("error"))}});return[c.useMemo(()=>{var i;return{contacts:((i=e==null?void 0:e.data)==null?void 0:i.data)||[],contactsLoading:s,contactsError:r,contactsValidating:a}},[e==null?void 0:e.contacts,r,s,a]),o]}function ne(){const{data:e,isLoading:s,error:r,refetch:o,isValidating:a}=rt(["chats"],{queryFn:()=>V.get(`${O}dashboard/restaurant/tickets/list`,{headers:{"Content-Type":"application/json","Accept-Language":$.language,Authorization:`Bearer ${m==null?void 0:m.token}`}}),onSuccess:i=>{},onError:()=>{D(C("error"))}});return c.useMemo(()=>{var i;return{conversations:((i=e==null?void 0:e.data)==null?void 0:i.data)||[],conversationsLoading:s,conversationsError:r,conversationsRefetch:o,conversationsValidating:a}},[e,r,s,a])}function z(){const{search:e}=ct(),r=new URLSearchParams(e).get("id"),{data:o,isLoading:a,error:n,refetch:i,isValidating:l}=rt(["chats-messages"],{queryFn:()=>V.get(`${O}dashboard/restaurant/tickets/messages?ticket_id=${r||1}`,{headers:{"Content-Type":"application/json","Accept-Language":$.language,Authorization:`Bearer ${m==null?void 0:m.token}`}}),onSuccess:g=>{},onError:()=>{D(C("error"))}});return[c.useMemo(()=>{var g;return{messages:((g=o==null?void 0:o.data)==null?void 0:g.data)||[],messagesLoading:a,messagesError:n,messagesRefetch:i,messagesValidating:l}},[o,n,a,l]),i]}async function se(e){var r;const s=`${O}dashboard/restaurant/tickets/messages`;try{const o=await V.get(s,{params:{ticket_id:e||1},headers:{"Accept-Language":$.language,Authorization:`Bearer ${m==null?void 0:m.token}`}}),a=(r=o==null?void 0:o.data)==null?void 0:r.data;Kt(s,a,!1)}catch(o){console.error("Error fetching data:",o)}}function oe(){const[e,s]=c.useState(!1),[r,o]=c.useState(!1),a=c.useCallback(()=>{o(p=>!p)},[]),n=c.useCallback(()=>{o(!1)},[]),i=c.useCallback(()=>{s(!0)},[]),l=c.useCallback(()=>{s(!1)},[]);return{openMobile:e,collapseDesktop:r,onOpenMobile:i,onCloseMobile:l,onCloseDesktop:n,onCollapseDesktop:a}}function ie(e){const s=c.useRef(null),r=c.useCallback(()=>{e&&s.current&&s.current&&(s.current.scrollTop=s.current.scrollHeight)},[e]);return c.useEffect(()=>{r()},[e]),{messagesEndRef:s}}function ft({selected:e,collapse:s,conversation:r,onCloseMobile:o}){B();const a=lt("up","md"),n=H(),i=c.useCallback(async()=>{try{a||o(),await se(r==null?void 0:r.id),n.push(`${G.dashboard.chat}?id=${r==null?void 0:r.id}`)}catch(p){console.error(p)}},[r.id,a,o,n]),l=t.jsx(W,{variant:r.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(S,{alt:r.title||"",src:r.img,sx:{width:48,height:48}})},r.status);return t.jsxs(dt,{disableGutters:!0,onClick:i,sx:{py:1.5,px:2.5,...e&&{bgcolor:"action.selected"}},children:[t.jsx(W,{color:"error",overlap:"circular",badgeContent:s?r.unreadCount:0,children:l}),!s&&t.jsx(t.Fragment,{children:t.jsx(pt,{sx:{ml:2},primary:r.title,primaryTypographyProps:{noWrap:!0,variant:"subtitle2"},secondary:(r==null?void 0:r.status)+" - "+(r==null?void 0:r.created_at.slice(11,19))})})]})}ft.propTypes={collapse:d.bool,conversation:d.object,onCloseMobile:d.func,selected:d.bool};function ce(){const{user:e}=B(),s=At(),[r,o]=c.useState("online");return c.useCallback(a=>{o(a.target.value)},[]),t.jsx(t.Fragment,{children:t.jsx(W,{variant:r,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(S,{src:e==null?void 0:e.photoURL,alt:e==null?void 0:e.displayName,onClick:s.onOpen,sx:{cursor:"pointer",width:48,height:48}})})})}function tt({sx:e,...s}){return t.jsxs(x,{spacing:2,direction:"row",alignItems:"center",sx:{px:2.5,py:1.5,...e},...s,children:[t.jsx(Y,{variant:"circular",sx:{width:48,height:48}}),t.jsxs(x,{spacing:1,flexGrow:1,children:[t.jsx(Y,{sx:{width:.75,height:10}}),t.jsx(Y,{sx:{width:.5,height:10}})]})]})}tt.propTypes={sx:d.object};function mt({query:e,results:s,onClickResult:r}){const o=s.length,a=!o&&!!e;return t.jsxs(t.Fragment,{children:[t.jsxs(E,{variant:"h6",sx:{px:2.5,mb:2},children:["Contacts (",o,")"]}),a?t.jsx(ht,{query:e,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}):t.jsx(t.Fragment,{children:s.map(n=>t.jsxs(dt,{onClick:()=>r(n),sx:{px:2.5,py:1.5,typography:"subtitle2"},children:[t.jsx(S,{alt:n.name,src:n.avatarUrl,sx:{mr:2}}),n.name]},n.id))})]})}mt.propTypes={query:d.string,results:d.array,onClickResult:d.func};const ot=320,le=96;function yt({loading:e,contacts:s,conversations:r,selectedConversationId:o,refetch:a}){const n=Lt(),i=H(),l=lt("up","md"),{collapseDesktop:p,onCloseDesktop:g,onCollapseDesktop:u,openMobile:P,onOpenMobile:F,onCloseMobile:T}=oe(),[y,M]=c.useState({query:"",results:[]});c.useEffect(()=>{l||g()},[g,l]);const N=c.useCallback(()=>{l?u():T()},[l,T,u]),I=JSON.parse(localStorage.getItem("settings")),A=window.localStorage.getItem("user_data"),L=et(A),[b,J]=c.useState(""),[j,v]=c.useState(!1),f=()=>{v(!j)},{mutate:K,error:at,isError:q,isLoading:_}=ut({mutationFn:h=>gt.post(`${O}dashboard/restaurant/tickets/create`,h,{headers:{"Content-Type":"multipart/form-data","Accept-Language":$.language,Authorization:`Bearer ${L==null?void 0:L.token}`}}),onSuccess:h=>{Ot(C("ticket-created")),a(),v(!1)},onError:()=>{notifyError(C("error"))}}),U=()=>{K({title:b})},Q=c.useCallback(()=>{M({query:"",results:[]})},[]),kt=c.useCallback(h=>{Q(),i.push(`${G.dashboard.chat}?id=${h.id}`)},[Q,i]),wt=t.jsx(R,{onClick:F,sx:{left:0,top:84,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",bgcolor:n.palette.primary.main,boxShadow:n.customShadows.primary,color:n.palette.primary.contrastText,"&:hover":{bgcolor:n.palette.primary.darker}},children:t.jsx(w,{width:16,icon:"solar:users-group-rounded-bold"})}),St=t.jsx(t.Fragment,{children:[...Array(12)].map((h,X)=>t.jsx(tt,{},X))}),Tt=t.jsx(t.Fragment,{children:r!=null&&r.conversationsLoading?t.jsx(k,{children:[...Array(12)].map((h,X)=>t.jsx(tt,{},X))}):t.jsx(t.Fragment,{children:(r==null?void 0:r.length)>0?t.jsx(t.Fragment,{children:r==null?void 0:r.map(h=>t.jsx(ft,{id:h==null?void 0:h.id,collapse:p,onCloseMobile:T,conversation:h,selected:(h==null?void 0:h.id)===o},h==null?void 0:h.id))}):t.jsx(k,{sx:{width:"100%",height:"550px",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(E,{sx:{fontSize:"24px",color:"grey.600"},children:"No Tickets"})})})}),It=t.jsx(mt,{query:y.query,results:y.results,onClickResult:kt});Qt,Z,y.query,`${C("search")}`,vt,w;const nt=t.jsxs(t.Fragment,{children:[t.jsxs(x,{direction:"row",alignItems:"center",justifyContent:"center",sx:{p:2.5,border:"1px solid #ffffff17",borderRadius:($.language==="en","20px 0px 0px 0px"),pb:"10px"},children:[!p&&t.jsxs(t.Fragment,{children:[t.jsx(ce,{}),t.jsx(k,{sx:{flexGrow:1}})]}),t.jsx(R,{onClick:N,children:t.jsx(w,{icon:p?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),t.jsxs(k,{sx:{position:"relative"},children:[t.jsx(R,{onClick:f,children:t.jsx(w,{width:24,icon:"solar:user-plus-bold"})}),t.jsxs(k,{sx:{position:"absolute",top:"0",right:"-300px",background:"#161c24",width:"300px",padding:"15px",borderRadius:"10px",zIndex:"100",transition:"0.3s",visibility:j?"":"hidden",opacity:j?"1":"0"},children:[t.jsx(Z,{sx:{width:"100%"},label:C("title"),variant:"outlined",type:"text",onChange:h=>{J(h.target.value)}}),t.jsx(x,{spacing:3,alignItems:"flex-end",sx:{mt:3},children:t.jsx(Rt,{onClick:U,variant:"contained",disabled:!!_,children:_?t.jsx($t,{color:(I==null?void 0:I.themeMode)==="dark"?"#161C24":"#ffffff",size:23}):C("create-ticket")})})]})]})]}),t.jsxs(xt,{sx:{pb:1},children:[y.query&&It,e&&St,!y.query&&!!(r!=null&&r.length)&&Tt]})]});return t.jsxs(t.Fragment,{children:[!l&&wt,l?t.jsx(x,{sx:{height:1,flexShrink:0,width:ot,borderRight:`solid 1px ${n.palette.divider}`,transition:n.transitions.create(["width"],{duration:n.transitions.duration.shorter}),...p&&{width:le}},children:nt}):t.jsx(Et,{open:P,onClose:T,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:ot}},children:nt})]})}yt.propTypes={contacts:d.array,conversations:d.array,loading:d.bool,selectedConversationId:d.number};var it=Ft;it&&it.isConcatSpreadable;d.func,d.bool,d.object;d.array;d.object;d.array;d.object,d.array;function jt({message:e}){const{user:s}=B(),r=t.jsxs(E,{noWrap:!0,variant:"caption",sx:{mb:1,textAlign:(e==null?void 0:e.replay)===1?"right":""},children:[(e==null?void 0:e.replay)===0?s==null?void 0:s.name:"Admin",t.jsx(E,{sx:{color:"grey.500",fontSize:"12px"},children:e==null?void 0:e.created_at.slice(11,19)})]}),o=t.jsx(x,{sx:{p:1.5,minWidth:48,maxWidth:320,borderRadius:1,typography:"body2",bgcolor:"background.neutral",...(e==null?void 0:e.replay)===1&&{color:"grey.800",bgcolor:"primary.lighter"}},children:e==null?void 0:e.message});return t.jsxs(x,{direction:"row",position:"relative",justifyContent:(e==null?void 0:e.replay)===1?"flex-start":"unset",flexDirection:(e==null?void 0:e.replay)===1?"row-reverse":"unset",sx:{mb:5},children:[t.jsx(S,{alt:e==null?void 0:e.message,src:(e==null?void 0:e.replay)===0?s==null?void 0:s.photo:"Admin",sx:{width:32,height:32,mr:(e==null?void 0:e.replay)===1?"":2,ml:(e==null?void 0:e.replay)===1?2:""}}),t.jsxs(x,{alignItems:(e==null?void 0:e.replay)===1?"flex-end":"unset",children:[r,t.jsx(x,{direction:"row",alignItems:"center",sx:{position:"relative","&:hover":{"& .message-actions":{opacity:1}}},children:o})]})]})}jt.propTypes={message:d.object,onOpenLightbox:d.func,participants:d.array};function bt({messages:e=[]}){const{messagesEndRef:s}=ie(e),r=e.filter(u=>u.contentType==="image").map(u=>({src:u.body})),o=Xt(r),[a,n,i,l]=z(),[p,g]=c.useState(a==null?void 0:a.messages);return c.useEffect(()=>{a&&g(a==null?void 0:a.messages)},[a==null?void 0:a.messages]),t.jsxs(t.Fragment,{children:[t.jsx(xt,{ref:s,sx:{px:3,py:5,height:1,position:"relative"},children:t.jsx(k,{children:a!=null&&a.messagesLoading?t.jsx(k,{children:t.jsx(Mt,{})}):t.jsx(t.Fragment,{children:(p==null?void 0:p.length)>0?t.jsx(t.Fragment,{children:p==null?void 0:p.map(u=>t.jsx(jt,{message:u,onOpenLightbox:()=>o.onOpen(u==null?void 0:u.body)},u==null?void 0:u.id))}):t.jsx(k,{sx:{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(E,{sx:{fontSize:"24px",color:"grey.600"},children:"No Messages"})})})})}),t.jsx(Yt,{index:o.selected,slides:r,open:o.open,close:o.onClose})]})}bt.propTypes={messages:d.array,participants:d.array};function Ct({recipients:e,onAddRecipients:s,disabled:r,selectedConversationId:o}){H();const{user:a}=B(),n=c.useRef(null),[i,l]=c.useState(""),p=c.useMemo(()=>({id:`${a==null?void 0:a.id}`,role:`${a==null?void 0:a.role}`,email:`${a==null?void 0:a.email}`,address:`${a==null?void 0:a.address}`,name:`${a==null?void 0:a.displayName}`,lastActivity:new Date,avatarUrl:`${a==null?void 0:a.photoURL}`,phoneNumber:`${a==null?void 0:a.phoneNumber}`,status:"online"}),[a]),g=c.useMemo(()=>({id:st(),attachments:[],body:i,contentType:"text",createdAt:Nt(new Date,{minutes:1}),senderId:p.id}),[i,p.id]);c.useMemo(()=>({id:st(),messages:[g],participants:[...e,p],type:e.length>1?"GROUP":"ONE_TO_ONE",unreadCount:0}),[g,p,e]),c.useCallback(()=>{n.current&&n.current.click()},[]);const u=c.useCallback(f=>{l(f.target.value)},[]),[P,F,T]=z(),{search:y}=ct(),N=new URLSearchParams(y).get("id");JSON.parse(localStorage.getItem("settings"));const I=window.localStorage.getItem("user_data"),A=et(I),{mutate:L,error:b,isError:J,isLoading:j}=ut({mutationFn:f=>gt.post(`${O}dashboard/restaurant/tickets/message/store`,f,{headers:{"Content-Type":"multipart/form-data","Accept-Language":$.language,Authorization:`Bearer ${A==null?void 0:A.token}`}}),onSuccess:f=>{F(),l("")},onError:()=>{D(C("error"))}}),v=()=>{L({ticket_id:N,message:i})};return t.jsx(t.Fragment,{children:t.jsx(_t,{value:i,onKeyDown:f=>{f.key==="Enter"&&v()},onChange:u,placeholder:"Type a message",disabled:r,endAdornment:t.jsxs(x,{direction:"row",sx:{flexShrink:0},children:[j?t.jsx(Zt,{loading:j,sx:{display:"flex",width:"auto"}}):"",t.jsx(R,{onClick:v,children:t.jsx(w,{icon:"eva:paper-plane-fill"})})]}),sx:{px:1,height:56,flexShrink:0,borderTop:f=>`solid 1px ${f.palette.divider}`}})})}Ct.propTypes={disabled:d.bool,onAddRecipients:d.func,recipients:d.array,selectedConversationId:d.number};function de({participants:e}){const s=e.length>1,r=e[0],o=t.jsx(te,{max:3,sx:{[`& .${zt.avatar}`]:{width:32,height:32}},children:e.map(n=>t.jsx(S,{alt:n.name,src:n.avatarUrl},n.id))}),a=t.jsxs(x,{flexGrow:1,direction:"row",alignItems:"center",spacing:2,children:[t.jsx(W,{variant:r.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(S,{src:r.avatarUrl,alt:r.name})}),t.jsx(pt,{primary:r.name,secondary:r.status==="offline"?Bt(r.lastActivity):r.status,secondaryTypographyProps:{component:"span",...r.status!=="offline"&&{textTransform:"capitalize"}}})]});return t.jsxs(t.Fragment,{children:[s?o:a,t.jsx(x,{flexGrow:1}),t.jsx(R,{children:t.jsx(w,{icon:"solar:phone-bold"})}),t.jsx(R,{children:t.jsx(w,{icon:"solar:videocamera-record-bold"})}),t.jsx(R,{children:t.jsx(w,{icon:"eva:more-vertical-fill"})})]})}de.propTypes={participants:d.array};function pe({contacts:e,onAddRecipients:s}){const[r,o]=c.useState(""),a=c.useCallback(n=>{o(""),s(n)},[s]);return t.jsxs(t.Fragment,{children:[t.jsx(E,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),t.jsx(Pt,{sx:{minWidth:320},multiple:!0,limitTags:3,popupIcon:null,disableCloseOnSelect:!0,noOptionsText:t.jsx(ht,{query:r}),onChange:(n,i)=>a(i),onInputChange:(n,i)=>o(i),options:e,getOptionLabel:n=>n.name,isOptionEqualToValue:(n,i)=>n.id===i.id,renderInput:n=>t.jsx(Z,{...n,placeholder:"+ Recipients"}),renderOption:(n,i,{selected:l})=>c.createElement("li",{...n,key:i.id},t.jsxs(k,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[t.jsx(S,{alt:i.name,src:i.avatarUrl,sx:{width:1,height:1}}),t.jsx(x,{alignItems:"center",justifyContent:"center",sx:{top:0,left:0,width:1,height:1,opacity:0,position:"absolute",bgcolor:p=>qt(p.palette.grey[900],.8),transition:p=>p.transitions.create(["opacity"],{easing:p.transitions.easing.easeInOut,duration:p.transitions.duration.shorter}),...l&&{opacity:1,color:"primary.main"}},children:t.jsx(w,{icon:"eva:checkmark-fill"})})]},i.id),i.name),renderTags:(n,i)=>n.map((l,p)=>c.createElement(Ut,{...i({index:p}),key:l.id,label:l.name,avatar:t.jsx(S,{alt:l.name,src:l.avatarUrl}),size:"small",variant:"soft"}))})]})}pe.propTypes={contacts:d.array,onAddRecipients:d.func};function he(){const e=H(),{t:s}=Gt(),{user:r}=B(),o=Wt(),a=Vt(),[n,i]=z(),l=parseInt(a.get("id"))||1,[p,g]=c.useState([]),{contacts:u}=ae(),{conversations:P,conversationsLoading:F,conversationsRefetch:T}=ne(),{conversation:y,conversationError:M}=z();y&&y.participants.filter(b=>b.id!==`${r.id}`),c.useEffect(()=>{(M||!l)&&e.push(G.dashboard.chat)},[M,e,l]);const N=c.useCallback(b=>{g(b)},[]),I=t.jsx(yt,{contacts:u,conversations:P,loading:F,refetch:T,selectedConversationId:l}),A=t.jsxs(x,{sx:{width:1,height:1,overflow:"hidden"},children:[l&&t.jsx(L,{selectedConversationId:l}),t.jsx(Ct,{recipients:p,onAddRecipients:N,selectedConversationId:l,disabled:!(n!=null&&n.messages.length)&&!l})]});function L({selectedConversationId:b,participants:J}){var _,U;const{data:j,isLoading:v,error:f,refetch:K,isValidating:at}=z(),q={messages:((U=(_=j==null?void 0:j.data)==null?void 0:_.data)==null?void 0:U.messages)||[],messagesLoading:v,messagesError:f,messagesRefetch:K,messagesValidating:at};return t.jsx(bt,{messages:q==null?void 0:q.messages})}return t.jsxs(Dt,{maxWidth:o.themeStretch?!1:"xl",children:[t.jsx(ee,{heading:s("technical-support"),links:[{name:s("dashboard"),href:G.dashboard.root},{name:s("technical-support")}],sx:{mb:{xs:3,md:5}}}),t.jsxs(x,{component:Ht,direction:"row",sx:{height:"72vh"},children:[I,t.jsx(x,{sx:{width:1,height:1,overflow:"hidden"},children:t.jsx(x,{direction:"row",sx:{width:1,height:1,overflow:"hidden",borderTop:b=>`solid 1px ${b.palette.divider}`},children:A})})]})]})}function Se(){return t.jsxs(t.Fragment,{children:[t.jsx(Jt,{children:t.jsx("title",{children:" Dashboard: Chat"})}),t.jsx(he,{})]})}export{Se as default};
